<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Johnson's technical blog"><title>R and R*Tree(一):The Dynamic Structure For Spatial Searching | Johnson King's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">R and R*Tree(一):The Dynamic Structure For Spatial Searching</h1><a id="logo" href="/.">Johnson King's Blog</a><p class="description">Johnson's blog</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa icon-rss"> RSS</i></a><a href="/guestbook/"><i class="fa fa-user"> Gästebuch</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">R and R*Tree(一):The Dynamic Structure For Spatial Searching</h1><div class="post-meta">Nov 1, 2016<span> | </span><span class="category"><a href="/categories/algorithm/">algorithm</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/" href="/2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>This article is not completed, I will add the demo codes to this article.</p>
<h2 id="1-Spatial-Searching"><a href="#1-Spatial-Searching" class="headerlink" title="1.Spatial Searching"></a>1.Spatial Searching</h2><p>Before I start to talking about it, you may have to know something of two words: “Dimensional” and “Searching”.</p>
<p>You always can hear a word called “Dimensional”, we used it in every aspect of life, and we always need to solve some problem about it. Straight line belongs to one dimensional space, and the plane is two dimensional and a cube is three-dimensional.</p>
<p>And “Searching”, If you are engaged in industries related to IT then you will not be unfamiliar with it, because we have mentioned so many, many times in our work and life. Searching for the information, the food’s information, the place’s information, the people’s information, We have been searching for this all the time.</p>
<p>So, what’s “Spatial Searching”?</p>
<p>Now we must post a question first: If our data is not one-dimensional(As we just said, an area, and other multi-dimentional data), how can we make the searching more efficiently?</p>
<p>That’s must be interesting, and you not need to be feel confuse for this because we have give you a method to resolve this problem : R-tree, and its change version,R* tree .</p>
<p>In this article, I will introduce this amazing invention to you(We will pay more focus on R*tree). To describe and explain its structure, and after that I will use the programming language to implement it(I’m  familiar with c++, so I will use this).</p>
<p>I assume that you already have considerable programming knowledge. And I will make it easy to understand as much as possible.</p>
<h2 id="2-R-tree"><a href="#2-R-tree" class="headerlink" title="2. R-tree"></a>2. R-tree</h2><p>I would like to create a new figure to express what’s the R-tree, so I want to use a picture of R-tree’s bounding box(It has a more serious name: minimum bounding rectangle, I guess.) and a tree structure’s figure to express the R-tree’s feature.<br><img src="\images\Algorithm\RTree\RTreeBound.png" alt="figure 2-0 The example of the R-tree&#39;s minimum bounding box"><br>In this picture, you can see the different Space division.<br>So, we can express the tree’s structure as this one:<br><img src="\images\Algorithm\RTree\RtreeStructure.jpg" alt="figure 2-1 The R-Tree&#39;s Structure(In this figure, the m equal to 2, M equal to 3)"><br>We can learn more about the r-tree’s structure. Anytime when we have a new node insert in our tree, we should consider about which path can keep the tree’s bounding box’s area in a minimum value, then we will choose that place.</p>
<p>Now, I will list its features:</p>
<ol>
<li>R-tree have two important value, we use m and M as trait of R-tree, each node（Except the root node） has child nodes from m to M. And the two values are depend on the situation.<br>If a leaf node is not a root, it should have a amount of records from m to M.</li>
<li>Each record belongs to a leaf node have a unified form, <em>(ex:[I, tumple identifier])</em> the <em>I</em> is a minimum bounding box on the n-dimentional space.</li>
<li>If a node isn’t a leaf node or a root node, it musts have a range of child nodes from m to M.</li>
<li>A Not-Leaf node’s structure,[I, child-pointer], the <em>I</em> a minimum bounding box which can include all the bounding boxes of its child-pointer.</li>
<li>If root node is not a leaf node, it must contain at least two nodes.</li>
<li>All the leaf nodes are on the same layer.</li>
</ol>
<p><em>The max value of R-tree’s height is (|Log2 m^n| - 1), because each node has m nodes at least, and the biggest value of nodes is equal to |N/M|+|N/M^2|+….+1 , so if all the nodes of a R-tree have m child-pointers except root node, it’s achieve the worst situation that when we excute this program’s searching operation.</em><br>If the tree’s structure meets all the requirements above, we can call this structure “R-tree”.<br>This Structure is very important in Database’s application, when we want to find some exact spots in your country, or a more a bigger range(The earth?), your searching program would use lots of time………(Just imagine you wait for five minutes to find a restaurant you are hungry.)</p>
<p>Now, we should Implement this tree sturcture by using the programming language(Matlab? Well, we can use matlab right? It’s a very convenient tool to do the experiment,but I want you to better understand this knowledge, I’d like to use C++.)<br><img src="\images\Algorithm\RTree\RTreeProFigure.png" alt="figure 2-2 A diagram of the contact between the classes"></p>
<p>If you don’t mind……, I will follow this structure to write the program. First, let’s look at its structure:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#pragma once</div><div class="line"> //R Tree&apos;s definition</div><div class="line">#include &lt;iostream&gt;</div><div class="line">#include &lt;vector&gt;</div><div class="line">using namespace std;</div><div class="line"> //interval</div><div class="line">class RTInter&#123;</div><div class="line">public:</div><div class="line">	float IMax;  // lower bound</div><div class="line">	float IMin;  // upper bound</div><div class="line"></div><div class="line">&#125;;</div><div class="line">// Use RTRange to define the Range of a Node,</div><div class="line">// you can use it to describe high-dimensional rectangle.</div><div class="line">typedef vector &lt;RTInter&gt;  RTRange;</div><div class="line"></div><div class="line"></div><div class="line">//Tree&apos;s Node</div><div class="line">class RTNode&#123;</div><div class="line"></div><div class="line">public:</div><div class="line">	int type; // Node&apos;s type</div><div class="line">	RTNode * Parent;        // Parent node</div><div class="line">	RTRange Nrange;         // Node&apos;s area</div><div class="line">	int childNum;           // children&apos;s number</div><div class="line">	RTNode ** childSet;     // child node pointer</div><div class="line">&#125;;</div><div class="line">typedef vector &lt;RTNode *&gt; RTNodeSet;  //a set for all the Node</div><div class="line">typedef vector &lt;double  &gt; RTPoint;    //use to record multidimensional point</div><div class="line"></div><div class="line">class Tree&#123;</div><div class="line">public:</div><div class="line">	int height;     // The height of the tree</div><div class="line">	int dim;        // The dimention of the tree</div><div class="line">	RTNode * Root;  // Root of the tree</div><div class="line">	int m;          // The minimum number of nodes</div><div class="line">	int M;          // The maximum number of nodes</div><div class="line"></div><div class="line">public:</div><div class="line">	Tree(void);</div><div class="line">	~Tree(void);</div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Until now, we have given the R-tree’s defination, but we didn’t give the R<em>tree’s structure.<br>Don’t worry, because that’s my decision. I will write the Rtree’s program, and when you understand the basic program, I will tell you the part of R</em>tree.<br>But to be honest, That’s must be a long article…. When I start to write this, I haven’t to realize this situation….Just Joking. :)</p>
<h2 id="3-Algorithm"><a href="#3-Algorithm" class="headerlink" title="3.Algorithm"></a>3.Algorithm</h2><p>Of course, the first operation is initialization, but I will start with a step that we all in common sence——–</p>
<h3 id="3-1-Searching-Algorithm"><a href="#3-1-Searching-Algorithm" class="headerlink" title="3.1 Searching Algorithm"></a>3.1 Searching Algorithm</h3><p>First, we will implement the searching algorithm, we use this to find the node in our searching area.<br>purpose: Find the nodes we want<br>When I try to describe these algorithm, you can see some different function in our code, some easy function I don’t perpare to display because I can’t make this article so long. :)<br>But I will give some interpretion.<br>Now, we begin, and we assume that the <em>T</em> represents the Root node, and the input parameter is S(the rectangle， if your R-tree is a structure with n-dimentional data, that’s must be a region that difficult to imagine.)</p>
<ol>
<li>If node T is not a leaf node, do the Searching in its child trees, find a EI intersect with the region S, and change the T to proto node’s child node, until find a leaf node.</li>
<li>If node T is a leaf node, get the <em>TI</em>(The T’s area.) and check if the EI’ region include the <em>S</em>.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">RTNode * Searching(RTNode * S_node,RTRange rect)&#123;</div><div class="line">	if(S_node-&gt;childSet == NULL)&#123;</div><div class="line">		if (Check(S_node-&gt;Nrange, rect))&#123;</div><div class="line"></div><div class="line">			return S_node;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	else&#123;</div><div class="line">		for(int i = 0;i &lt; S_node-&gt;childNum - 1; i++)</div><div class="line">		&#123;</div><div class="line">			Searching(S_node -&gt;childSet[i], rect);</div><div class="line">		&#125;</div><div class="line">		return 0;</div><div class="line">	&#125;;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-2-Insert-Algorithm"><a href="#3-2-Insert-Algorithm" class="headerlink" title="3.2 Insert Algorithm"></a>3.2 Insert Algorithm</h3><p>purpose: Insert a new index E in the R-Tree</p>
<ol>
<li>Call this function <em>Choose Leaf</em> to find a place P to insert the new item E</li>
<li>If P have the room(L not have M nodes) we will insert the E to P, but if P is filled with nodes, then we would call the <em>splitNode</em> function and get p and pp which have the whole nodes include E and the original entry P.</li>
<li>Call the funcition <em>AdjustTree</em> on L, if we have already split the L, we adjusted the LL, too.</li>
<li>If the node split caused the division of root node, the program will create a new root node which have two exist nodes.</li>
</ol>
<h3 id="3-3-Choose-Leaf-Algorithm"><a href="#3-3-Choose-Leaf-Algorithm" class="headerlink" title="3.3 Choose Leaf Algorithm"></a>3.3 Choose Leaf Algorithm</h3><p>Then, we should find a place to store our new node.<br>We call the “Choose Leaf”.</p>
<p>We called it “the Choose Leaf Algorithm”, it not only consider for the initialization, but also  for the insert opreration.<br>We use this algorithm to find a leaf node to insert a new node.<br>Should we describe this algorithm by the natural language? Well, just for help you get more understand about this algorithm, it also can helpful to myself.<br>purpose: Find a leaf node to place a new item E</p>
<ol>
<li>We set the root node is N.</li>
<li>If N is a leaf node, the function will add the new node E to N.</li>
<li>If N is not a leaf node, and the N has several pointers of index. We use F as a index in N, and if we want to add the E to the F’s child-pointer, we should expend the area of F to include the area of E(Of course we should keep the minimum area.), then we caculate the new area of F(We called it FI.), but we couldn’t to choose this ‘F’ by chosing randomly.<br>We will do this operation for all the child-pointers of N. And we can get the minimum area, and find a benefit child node of N, we use the x to express it.</li>
<li>And we do the loop operation from the ‘2’, until we find the ‘x’ is a leaf node.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">int ChooseLeaf(RTNode N_node, RTNode * S_node)&#123;</div><div class="line">	double Area_t = 0; //create for store the area</div><div class="line">	if(S_node-&gt;childSet == NULL)&#123;</div><div class="line">		*(S_node-&gt;childSet)[0] = N_node; //as a new child node of N_node</div><div class="line">	&#125;</div><div class="line">	else&#123;</div><div class="line">		for(int i = 0; i &lt; S_node-&gt;childNum - 1 ;i++)</div><div class="line">		&#123;</div><div class="line">			//add the new node&apos;s region in a child node, and calculate the new value of range</div><div class="line">            //Area_t = addArea();</div><div class="line"></div><div class="line">             //addnode();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-4-Adjust-Tree-Algorithm"><a href="#3-4-Adjust-Tree-Algorithm" class="headerlink" title="3.4 Adjust Tree Algorithm"></a>3.4 Adjust Tree Algorithm</h3><p>purpose: Change the “L” node to become the root node, this function can adjust the R-tree’s structure.</p>
<ol>
<li>We use the N as a signal of L, and if L has already spilt, we will use the NN to represent the LL.</li>
<li>If N is a root node, then we will stop this algorithm.</li>
<li>We use P to represent N’s parent’s node, and EN is the N’s index in P’s child-pointer. Adjusting the ENI to include all the nodes of N.</li>
<li>If N have already spilt, there must be a NN node in our sequence, if this happen, we will create a new node ENN(NN is it’s parent node, we can use “Let ENNP points to NN” to express), and of course, the ENN’s rectangle(ENNI) is enclosing to the all the rectangle of NNI. If P still has the enough space, add the ENN to the P’s child-set, or use the <em>splitNode</em> to create the P, PP, ENN, and all the nodes of P.</li>
<li>Set N = P, if a split program cause the NN = PP, loop the step from the <em>2.</em> step.<br>To Be Continue……..<br>I will see you in next article. :)</li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://finalagito.github.io/2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/" data-id="ciy0w69dl00087wfxis5en044" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/Mining-Data/">Mining Data</a></div><div class="post-nav"><a href="/2017/01/17/R-and-R-Tree-二-The-Dynamic-Structure-For-Spatial-Searching/" class="pre">R and R*Tree(二):The Dynamic Structure For Spatial Searching</a><a href="/2016/08/17/The-Linar-Regression-The-First-Step-Of-Machine-Learning/" class="next">The Linar Regression: The First Step Of Machine Learning</a></div><div id="disqus_thread"><script>var disqus_shortname = 'finalagito-github-io-1';
var disqus_identifier = '2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/';
var disqus_title = 'R and R*Tree(一):The Dynamic Structure For Spatial Searching';
var disqus_url = 'https://finalagito.github.io/2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//finalagito-github-io-1.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://finalagito.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C-设计模式/">C++设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning/">Machine Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/C/" style="font-size: 15px;">C++</a> <a href="/tags/Mining-Data/" style="font-size: 15px;">Mining Data</a> <a href="/tags/Machine-Learning/" style="font-size: 15px;">Machine Learning</a> <a href="/tags/Big-Data/" style="font-size: 15px;">Big Data</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/01/17/R-and-R-Tree-二-The-Dynamic-Structure-For-Spatial-Searching/">R and R*Tree(二):The Dynamic Structure For Spatial Searching</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/R-and-R-Tree-一-The-Dynamic-Structure-For-Spatial-Searching/">R and R*Tree(一):The Dynamic Structure For Spatial Searching</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/The-Linar-Regression-The-First-Step-Of-Machine-Learning/">The Linar Regression: The First Step Of Machine Learning</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/05/The first Course Of Machine Learning/">The first Course Of Machine Learning</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/31/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/31/C-设计模式（二）：单例模式/">C++设计模式（二）：单例模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/21/C-设计模式（一）：工厂模式/">C++设计模式（一）：工厂模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Letzte Kommentare</i></div><script type="text/javascript" src="//finalagito-github-io-1.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Johnson King's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>